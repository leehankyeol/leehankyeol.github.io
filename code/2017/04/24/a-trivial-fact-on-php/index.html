<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>오늘의 전혀 훌륭하지 않은 PHP 상식 &#8211; 이한결 블로그</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="하여튼 PHP 너모 무시무시하고 위험한 언어다. 새로 만들게 될 쇼핑몰 API부터 나는 node.js로 완전히 갈아탈 것이다.">
    <meta name="author" content="Lee Han Kyeol">
    <meta name="keywords" content="Code">
    <link rel="canonical" href="http://leehankyeol.me/code/2017/04/24/a-trivial-fact-on-php/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for 이한결 블로그" href="/feed.xml" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?201704301237" type="text/css">

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    

    <!-- Verifications -->
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="오늘의 전혀 훌륭하지 않은 PHP 상식">
    <meta property="og:description" content="술과 여자를 좋아합니다.">
    <meta property="og:url" content="http://leehankyeol.me/code/2017/04/24/a-trivial-fact-on-php/">
    <meta property="og:site_name" content="이한결 블로그">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    
    <meta name="twitter:title" content="오늘의 전혀 훌륭하지 않은 PHP 상식" />
    <meta name="twitter:description" content="하여튼 PHP 너모 무시무시하고 위험한 언어다. 새로 만들게 될 쇼핑몰 API부터 나는 node.js로 완전히 갈아탈 것이다." />
    <meta name="twitter:url" content="http://leehankyeol.me/code/2017/04/24/a-trivial-fact-on-php/" />

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">

    
</head>

<body class="site">
  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="/" class="site-title">이한결 블로그</a>
      <nav class="site-nav">
        <a href="/about/">About</a>
<a href="/book">Book</a>
<a href="/code">Code</a>
<a href="/life">Life</a>
<a href="/movie">Movie</a>
<a href="/music">Music</a>
<a href="/travel">Travel</a>

      </nav>
      <div class="clearfix"></div>
      
        <div class="social-icons">
  <div class="social-icons-right">
    
      <a class="fa fa-github" href="https://github.com/leehankyeol"></a>
    
    
    
      <a class="fa fa-stack-overflow" href="https://stackoverflow.com/users/4286919"></a>
    
    <a class="fa fa-rss" href="/feed.xml"></a>
    
    
    
    
    
    
  </div>
  <div class="right">
    
    
    
  </div>
</div>
<div class="clearfix"></div>

      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<div class="post-header mb2">
  <h1>오늘의 전혀 훌륭하지 않은 PHP 상식</h1>
  <span class="post-meta">Apr 24, 2017</span><br>
  
  <span class="post-meta small">
  
    1 minute read
  
  </span>
</div>

<article class="post-content">
  <ol>
  <li>
    <p>같은 데이터베이스를 기반으로 다른 두 개의 API가 구축되어 있는 회사 서비스가 있다. 내가 만든 API는 일종의 관리 툴에 쓰이는 것으로, 다른 관리자나 일반 사용자를 추가, 삭제하는 기능이 있다. 내가 회사에 오기 전부터 구축되어 있던 API는 일반 사용자들이 쓰는 API다. BCrypt로 비밀번호를 암호화하고 있다고 하길래 내가 새롭게 만들기 시작한 API에서도 BCrypt 방식을 사용했다. 여태까지 별 문제가 없는 줄 알았는데 언젠가부터 관리 툴에서 사용자를 만들고 다른 API를 통해 로그인을 시도하면 비밀번호가 잘못되었다는 에러가 발생한다는 리포트가 들어왔다.</p>
  </li>
  <li>
    <p>코드상 문제는 없어보여서 DB를 열어봤다. 한 눈에 대단한 문제점이 보이지 않는 가운데 암호화된 비밀번호 문자열에서 특이한 사항이 보였다. 기존 API를 통해 만들어진 암호화 문자열이 $2a$로 시작하는 반면, 내가 만든 API의 암호화 문자열은 $2y$로 시작하는 것이 아닌가. 검색을 해봤다.</p>
  </li>
  <li>
    <p><a href="https://security.stackexchange.com/questions/20541/insecure-versions-of-crypt-hashes">스택익스체인지 보안 관련 질문 스레드</a>를 찾았다. 정리하면 이런 이야기다. PHP에서 BCrypt를 구현한 crypt_blowfish라는 패키지가 있다. 해당 패키지에서 아스키 코드가 아닌 문자열로 해시를 했을 때 잘못된 결과를 뱉어내는 버그가 발견되었고 2011년 6월에 버그를 수정했다고 한다. 여기까지는 일반적이다. 하나 일반적이지 않은 것은, 그렇게 버그를 수정한 crypt_blowfish 패키지는 해당 버그를 수정했다는 의미에서 기존 $2a$로 시작하는 암호화 문자열을 제멋대로(?) $2y$로 시작하는 형식으로 바꾸자고 제안했다는 것이다. 당연하게도 그 제안은 OpenBSD를 포함, 그 누구도 받아들이지 않았고 오로지 PHP의 crypt_blowfish 패키지만 사용하게 되었다고 한다. 다른 BCrypt 관련 라이브러리, 패키지가 $2y$로 시작하는 암호화 문자열을 제대로 매치하지 못하는 건 당연한 수순.</p>
  </li>
  <li>
    <p>암호화 문자열의 시작 부분이 알고리즘 자체에 영향을 미치는 부분은 아니기 때문에 $2y$ 부분을 $2a$로 고쳐주기만 하면 해결되는 문제긴 하다. PHP의 정규식 치환을 사용한 코드로 바꿔주니 제대로 동작하는 것을 확인할 수 있었다. 라라벨의 해시 패키지는 그나마 똑똑한(?) 편이라 $2a$ 버전이든, $2y$ 버전이든 문제없이 해시값을 매치해주는 것 같다.</p>
  </li>
  <li>
    <p>하여튼 PHP 너모 무시무시하고 위험한 언어다. 새로 만들게 될 쇼핑몰 API부터 나는 node.js로 완전히 갈아탈 것이다.</p>
  </li>
</ol>

</article>


  <div class="share-page">
  Share this post

  <div class="share-links">
    
      <a class = "fa fa-facebook" href="https://facebook.com/sharer.php?u=http://leehankyeol.me/code/2017/04/24/a-trivial-fact-on-php/" rel="nofollow" target="_blank" title="Share on Facebook"></a>
    

    
      <a class="fa fa-twitter" href="https://twitter.com/intent/tweet?text=오늘의 전혀 훌륭하지 않은 PHP 상식&url=http://leehankyeol.me/code/2017/04/24/a-trivial-fact-on-php/" rel="nofollow" target="_blank" title="Share on Twitter"></a>
    

    

    

    

    

    

    

    


  </div>
</div>




  <div class="py2 post-footer">
  <img src="/images/bender.png" alt="Bender" class="avatar" />
  <p>
    Lee, Han Kyeol
  </p>
  <p>
    I like women and booze.
  </p>
</div>






  <h3 class="related-post-title">Related Posts</h3>
  
    
  
    
  
    
  
    
  
    
    <div class="post ml2">
      <a href="/code/2017/03/24/what-i-learned-from-stack-overflows-massive-servey-of-64000-developers/" class="post-link">
        <h4 class="post-title">2017 스택오버플로우 설문조사 결과 요약</h4>
        <p class="post-summary">2017 스택오버플로우 설문조사 결과가 발표되었고 이 글은 그 결과를 십수 문장으로 압축한 결과물이다. 자세한 그래프는 원문을 참고하면 되고 아래는 글쓴이가 각 항목에 달아놓은 헤드라인을 우리말로 옮긴 것이다. 영어로 developer로 표현한 것은 개발자로, programmer로 표현한 것은 프로그래머로 번역했다. 괄호 안의 문장은 내가 고른 특이사항이다.</p>
      </a>
    </div>
    
  
    
  
    
  
    
  
    
  
    
  


      </div>
    </div>
  </div>

  <footer class="center">
  <div class="measure">
    <small>
      Theme crafted with &lt;3 by <a href="http://johnotander.com">John Otander</a> (<a href="https://twitter.com/4lpine">@4lpine</a>), slightly updated withoug &lt;3 by <a href="http://leehankyeol.me">Lee Han Kyeol</a>.<br>
      &lt;/&gt; available on <a href="https://github.com/johnotander/pixyll">Github</a>.
    </small>
  </div>
</footer>

</body>
</html>
